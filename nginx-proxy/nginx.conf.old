server {
  set_by_lua $PROXY_FRONT_PORT 'sub { return $ENV{"PROXY_FRONT_PORT"}; }';
  set_by_lua $PROXY_BACK_PORT 'sub { return $ENV{"PROXY_BACK_PORT"}; }';
  set_by_lua $PROXY_BACK_SERVER 'sub { return $ENV{"PROXY_BACK_SERVER"}; }';

  listen $PROXY_FRONT_PORT;
 
  location / {
    proxy_pass http://$PROXY_BACK_SERVER:$PROXY_BACK_PORT;
    auth_basic "Restricted";
    auth_basic_user_file /etc/nginx/.htpasswd;
  }
}

